=============================================================
üî• SISTEMA DE RACHAS Y PROGRESO - DOCUMENTACI√ìN COMPLETA
=============================================================

ALGORITMO DE RACHAS
===================

1. C√ÅLCULO AUTOM√ÅTICO (SQL Trigger)
   - Se activa al INSERT/UPDATE en daily_activity
   - Compara fecha actual con √∫ltima actividad
   - L√≥gica:
     * Si es d√≠a consecutivo ‚Üí +1 a racha
     * Si es mismo d√≠a ‚Üí No cambia
     * Si hay salto ‚Üí Reinicia a 1

2. VERIFICACI√ìN AL INICIAR SESI√ìN
   - checkAndUpdateStreak() se ejecuta autom√°ticamente
   - Si han pasado >1 d√≠a sin actividad ‚Üí Racha = 0
   - Previene rachas falsas por inactividad

3. PERSISTENCIA EN DATABASE
   - Tabla: student_stats
   - Campos:
     * current_streak (INT)
     * longest_streak (INT)
     * last_activity_date (DATE)


SISTEMA DE EXPERIENCIA (XP) Y NIVELES
======================================

1. GANANCIAS DE XP:
   ‚úÖ Completar Lecci√≥n: +50 XP
   üí™ Completar Ejercicio: +25 XP
   üìù Aprobar Evaluaci√≥n: +100 XP

2. C√ÅLCULO DE NIVEL:
   F√≥rmula: Nivel = ‚àö(XP / 100) + 1
   
   Progresi√≥n:
   - Nivel 1: 0-100 XP
   - Nivel 2: 100-400 XP
   - Nivel 3: 400-900 XP
   - Nivel 4: 900-1600 XP
   - Nivel 5: 1600-2500 XP
   - etc.

3. NOTIFICACI√ìN DE SUBIDA:
   - Se muestra cuando leveledUp = true
   - "üéâ ¬°Subiste al Nivel X!"


REGISTRO DE ACTIVIDAD DIARIA
=============================

1. TABLA: daily_activity
   Campos:
   - user_id (UUID)
   - activity_date (DATE)
   - lessons_completed (INT)
   - time_spent_minutes (INT)
   - exercises_completed (INT)

2. M√âTODO: recordDailyActivity()
   - UPSERT: Crea o actualiza registro del d√≠a
   - Trigger autom√°tico actualiza racha
   - Actualiza totales en student_stats


PROGRESO POR MATERIA
=====================

1. TABLA: subject_progress
   Campos:
   - user_id (UUID)
   - subject_id (TEXT)
   - subject_name (TEXT)
   - completed (BOOLEAN)
   - progress_percentage (INT 0-100)
   - completed_at (TIMESTAMP)

2. ACTUALIZACI√ìN:
   - Lecci√≥n completada: +5%
   - Evaluaci√≥n aprobada: +10%
   - Al llegar a 100%: completed = true


EVALUACIONES
============

1. TABLA: evaluations
   Campos:
   - user_id (UUID)
   - subject_id (TEXT)
   - evaluation_type (TEXT)
   - title (TEXT)
   - score (DECIMAL)
   - max_score (DECIMAL)
   - passed (BOOLEAN)

2. CRITERIO DE APROBACI√ìN:
   - Passed = (score / max_score) >= 0.6
   - 60% m√≠nimo para aprobar

3. EFECTOS:
   - Si passed = true:
     * +10% progreso en materia
     * +100 XP


FUNCIONES PRINCIPALES EN AUTH.JS
=================================

1. completeLesson(subjectId, subjectName, timeSpent)
   - Registra lecci√≥n en daily_activity
   - Actualiza progreso (+5%)
   - Trigger actualiza racha autom√°ticamente

2. completeExercise(subjectId, subjectName, timeSpent)
   - Registra ejercicio en daily_activity
   - Actualiza contador de ejercicios

3. submitEvaluation(subjectId, ..., score, maxScore)
   - Guarda evaluaci√≥n en database
   - Si aprob√≥: actualiza progreso (+10%)
   - Retorna si pas√≥ o no

4. checkAndUpdateStreak()
   - Verifica √∫ltima actividad
   - Rompe racha si >1 d√≠a sin actividad
   - Se llama al cargar portal

5. addExperience(amount)
   - A√±ade XP al usuario
   - Recalcula nivel
   - Retorna si subi√≥ de nivel

6. calculateLevel(xp)
   - F√≥rmula: ‚àö(xp/100) + 1
   - Retorna nivel calculado


FLUJO DE USO T√çPICO
====================

1. USUARIO INICIA SESI√ìN
   ‚Üì
2. checkAndUpdateStreak() verifica racha
   ‚Üì
3. USUARIO COMPLETA LECCI√ìN
   ‚Üì
4. completeLesson() registra actividad
   ‚Üì
5. TRIGGER SQL actualiza racha
   ‚Üì
6. addExperience(50) a√±ade XP
   ‚Üì
7. Si level_up: muestra notificaci√≥n
   ‚Üì
8. Portal actualiza UI con nuevos datos


P√ÅGINA DE DEMO
==============

Ubicaci√≥n: portal/demo-rachas.html

Funcionalidades:
‚úÖ Bot√≥n "Completar Lecci√≥n" (+30 min, +50 XP)
‚úÖ Bot√≥n "Completar Ejercicio" (+15 min, +25 XP)
‚úÖ Formulario de evaluaci√≥n
‚úÖ Estad√≠sticas en tiempo real
‚úÖ Registro de actividades

Acceso:
- Desde men√∫ del usuario
- "üî• Demo: Sistema de Rachas"


SEGURIDAD (RLS)
===============

Todas las tablas tienen Row Level Security:
- Users can only SELECT their own data
- Users can only INSERT their own data
- Users can only UPDATE their own data

Policy check: auth.uid() = user_id


OPTIMIZACIONES
==============

1. √çNDICES EN DATABASE:
   - idx_daily_activity_user_id
   - idx_daily_activity_date
   - idx_student_stats_user_id
   - idx_subject_progress_user_id

2. TRIGGERS AUTOM√ÅTICOS:
   - update_streak() ‚Üí Calcula racha
   - update_updated_at_column() ‚Üí Actualiza timestamps

3. ALGORITMO EFICIENTE:
   - Un solo INSERT actualiza todo
   - Trigger hace c√°lculos en DB (m√°s r√°pido)
   - No requiere m√∫ltiples queries


PRUEBAS RECOMENDADAS
====================

1. Ir a portal/demo-rachas.html
2. Completar 3 lecciones
   - Deber√≠a sumar: +90 min, +150 XP
   - Racha deber√≠a ser 1 (hoy)
3. Completar 2 ejercicios
   - Deber√≠a sumar: +30 min, +50 XP
   - Total: 200 XP ‚Üí Nivel 2
4. Registrar evaluaci√≥n con 85 puntos
   - Deber√≠a aprobar
   - +100 XP ‚Üí Total 300 XP
5. Verificar en perfil.html que todo se actualiz√≥


PR√ìXIMAS MEJORAS
================

‚ñ° Gr√°fico de actividad (√∫ltimos 30 d√≠as)
‚ñ° Racha de fuego animada
‚ñ° Badges por logros
‚ñ° Comparaci√≥n con otros estudiantes
‚ñ° Metas diarias personalizadas
‚ñ° Notificaciones de recordatorio
‚ñ° Recompensas por rachas largas

=============================================================
